<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.9/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.9/js/plugins/piexif.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.9/js/plugins/sortable.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/5.0.9/js/fileinput.min.js"></script>

</head>
<body>

    <p>{{ message }}</p>
    
    <div class="container">
        <form id="upload-file" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <div class="file-loading">
                    <label>Preview File Icon</label>
                    <input id="file-3" type="file" name="file[]" multiple>
                </div>
            </div>
        </form>
        <div class="fixed-bottom p-3">
            <button type="button" class="btn btn-primary btn-lg btn-block" id="upload-file-btn" >อัพโหลดรูปภาพ</button>
        </div>
    </div>

    <script>
    $(document).ready(function() {

        $("#file-3").fileinput({
            theme: 'fas',

            dropZoneTitle: "โปรดเลือกรูปภาพที่ต้องการอัพโหลด",
            dropZoneClickTitle : '<button type="button" class="btn btn-primary btn-lg btn-block btn-newimage" id="upload-file-btn" >เพิ่มรูปภาพใหม่</button>',
            browseClass: "btn btn-primary btn-lg",
            previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",

            overwriteInitial: false,
            initialPreviewAsData: true,

            {% if preview is not none %}
            initialPreview: [
                {% for item in preview %}
                    "{{item}}",
                {% endfor %}
            ],
            {% endif %}

            {% if preview_config is not none %}
            initialPreviewConfig: [
                {% for item in preview_config %}
                    {caption : "{{item['caption']}}", url: "{{item['url']}}", key: "{{item['key']}}"},
                {% endfor %}
            ],
            {% endif %}
            
            showUpload: false,
            showBrowse: false,
            showClose: false,
            showCancel: false,
            showRemove: false,
            showUpload: false,
            showCaption: false,
            showUploadStats:false,
            showUploadedThumbs : false,
            dropZoneEnabled:true,
            browseOnZoneClick:true,
            
            maxFileCount: 9,
            validateInitialCount: true,
            allowedFileExtensions: ['jpg', 'png', 'jpeg', 'HEIC'],

        });

    $("#file-3").on("filepredelete", function(jqXHR,index) {
        console.log('delete')
        $('.file-preview-frame[data-fileindex=init_'+index+"]").fadeOut(300);
    }); 

    $('#upload-file-btn').click(function() {

        var form_data = new FormData($('#upload-file')[0]);
        console.log(form_data)
        
        // it's can be pass `line_id` value by params query
        $.ajax({
            type: 'POST',
            url: '/upload?line_id=12345678',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            success: function(data) {
                console.log('Success!');
                // close line liff here
            },
        });

    });

    });

    </script>

    <style>
        body{
            font-size: 14px;
        }
        .btn{
            font-size: 18px;
            background-color: #2c2f8c;
            border-color: #2c2f8c;
            padding: 8px;
        }
        .btn-newimage{
            background-color: #fff;
            color: #2c2f8c !important;
            box-shadow: none !important;
            margin-top: 15px;
        }
        .file-preview .clickable{
            width: 100%;
            max-width: 320px;
        }
        .file-preview{
            display: flex;
            justify-content: center;
        }
        .kv-file-zoom, .kv-file-upload, .file-drag-handle, .file-upload-indicator{
            display: none;
        }
        .file-footer-buttons button{
            background: #fff;
            color: #f50404;
            border-color: #f90404;
            padding: 5px;
            font-size: 10px;
        }
        .file-drop-zone {
            border: 0;
            border-radius: 0;
            text-align: center;
            vertical-align: middle;
            margin: 0;
            /* padding: 5px; */
        }
        .file-drop-zone.clickable:hover{
            border: none;
        }
        .file-footer-caption{
            display: none !important;
        }
        .krajee-default.file-preview-frame .kv-file-content{
            background-color: #d8d8d8;
            position: relative;
            width: 125px !important;
            height: 125px !important;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .krajee-default.file-preview-frame .file-thumbnail-footer{
            height: 30px;
        }
        .kv-file-content img.kv-preview-data{
            max-width: inherit !important;
            height: 100% !important;
        }
        .file-thumbnail-footer{
            height: auto;
        }
        .file-thumbnail-footer {
            height: auto !important;
            position: absolute !important;
            bottom: 7.5px;
            right: 7.5px;
        }
    </style>

    <style>

        @media only screen and (max-width: 767px) {
            .file-preview{
                display: flex;
                justify-content: center;
            }
            .file-preview-thumbnails {
                display: block;
                justify-content: inherit;
                align-items: inherit;
                flex-direction: inherit;
            }
        }
    </style>
    
</body>
</html>